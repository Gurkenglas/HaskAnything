<link rel="stylesheet" href="/vendor/select2/css/select2.min.css"/>
<script src="/vendor/select2/js/select2.full.min.js"></script>
<script src="/js/querystring.js"></script>
<script src="/vendor/underscore/underscore.js"></script>
<script src="/vendor/facetedsearch//facetedsearch.js"></script>
<script type="text/javascript">

jQuery(document).ready(function() {

    // This contains the metadata for all content on the site. Auto-generated.
    var items = [
    $partial("templates/content-data.html")$
        ];

    var item_template =
     '<div class="item col-md-6 col-sm-12">' +
         '<div class="item-header">' +
         '<h4><a href="<%= obj.url %>"><%= obj.title %></a></h4>' +
         '<span class="item-category"><% if (obj.categories) {  %><%= obj.categories %><% } %></span>' +
         '</div>' +
         '<% if (obj.tags && obj.tags.length) {  %><p class="tags">Tags: <%= obj.tags %></p><% } %>' +
         '<% if (obj.libraries && obj.libraries.length) {  %><p class="libraries">Libraries: <%= obj.libraries %></p><% } %>' +
       '</div>';
      var settings = {
        items           : items,
        facets          : {
                            'categories'     : 'Categories',
                            'tags'         : 'Tags',
                            'libraries'     : 'Libraries'
        },
        resultSelector  : '#results',
        facetSelector   : '#facets',
        resultTemplate  : item_template,
        showMoreTemplate: '<div class="col-sm-12"><a id=showmorebutton>Show more</a></div>',
        paginationCount : 25,
        orderByOptions  : {'title': 'Title', 'category': 'Categories', 'tags': 'Tags', 'libraries': 'Libraries'}
      };


    // Add event handler
    jQuery('#facets').on("facetuicreated", function(){

      jQuery('.bottomline').insertAfter('#facets');

      setTimeout( function() {
        // Read querystring for data.
        var facets = ['categories','tags','libraries'];

        var readQuerystring = function(elem) {
          if( getParameterByName(elem) ) {
            var e = getParameterByName(elem);
            jQuery('.facetitem:contains("' + e + '")').click();
          }
        };

        R.map( readQuerystring,facets);

      }, 25 );

    });

    jQuery('#results').on("facetedsearchresultupdate", function(){
       var settings = jQuery.getFacetSettings();
       var count = settings.currentResults.length;
       var resultText = (count > 1 || count == 0) ? "Results" : "Result";
       var finalText = count + " " + resultText;
       if (count > settings.paginationCount) {
         finalText = settings.paginationCount + " " + resultText + ' (out of ' + settings.currentResults.length + ')';
       }
       else {
         finalText = count + " " + resultText;
       }
       jQuery('#resultsHeader').text( finalText );
     });


    jQuery(function(){
      jQuery.facetelize(settings);
    });
});
</script>

<h1>$title$</h1>

<div class="row col-md-12 col-sm-12">
<div id="facets"></div>
</div>

<div class="row col-md-12 col-sm-12">
    <h2 id="resultsHeader">Results</h2>
    <div id="results"></div>
</div>
